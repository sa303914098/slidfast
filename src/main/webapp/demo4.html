<!DOCTYPE html>
<html lang="en">

<head>
<title>HTML5Rocks Article Demo 4</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0"/>
<!-- enable full-screen mode -->
<meta name="apple-mobile-web-app-capable" content="yes"/>
<!-- controls the appearance of the status bar in full-screen mode -->
<meta name="apple-mobile-web-app-status-bar-style" content="black"/>
<link rel="stylesheet" href="styles/demo1.css" type="text/css"/>
<script type="text/javascript" src="js/demo1.js"></script>
<script type="text/javascript" src="js/demo2.js"></script>

<style type="text/css">

</style>
<script type="text/javascript">


//    demo3----------------------------checking network type

//2 types of of data loading scenarios, straightup request and the changing of state in connection (event)
var appCache = window.applicationCache;
var disabledLinks = '';

window.addEventListener('load', function(e) {
   if (navigator.onLine) {
      //new page load
      processOnline();
   }else{
      //the app is probably already cached and (maybe) bookmarked...
      processOffline();
   }
}, false);

window.addEventListener("offline", function(e) {
   //we just lost our connection and entered offline mode, disable eternal link
   processOffline(e.type);
}, false);

window.addEventListener("online", function(e) {
  //just came back online, enable links
  processOnline(e.type);
}, false);

function processOnline(event){

    setupApp();
    checkAppCache();

    //reset our once disabled offline links
    if(event){
        for (i = 0; i < disabledLinks.length; i += 1) {
            disabledLinks[i].onclick = null;
        }
    }

    function checkAppCache(){
        //check for a new appCache
        window.applicationCache.addEventListener('updateready', function(e) {
           //alert('checking appcache' + window.applicationCache.status);
            if (window.applicationCache.status == window.applicationCache.UPDATEREADY) {
              // Browser downloaded a new app cache.
              // Swap it in and reload the page to get the new hotness.
              window.applicationCache.swapCache();
              if (confirm('A new version of this site is available. Load it?')) {
                window.location.reload();
              }
            }else{}
        }, false);
    }

}

function setupApp(){
    // create a custom object if navigator.connection isn't available
    var connection = navigator.connection || {'type':'0'};
    if (connection.type == 2 || connection.type == 1){
        //wifi/ethernet
        //Coffee Wifi latency: ~75ms-200ms
        //Home Wifi latency: ~25-35ms
        //Coffee Wifi DL speed: ~550kbps-650kbps
        //Home Wifi DL speed: ~1000kbps-2000kbps
        fetchAndCache(true);
    }else if (connection.type == 3){
    //edge
        //ATT Edge latency: ~400-600ms
        //ATT Edge DL speed: ~2-10kbps
        fetchAndCache(false);
    }else if (connection.type == 2){
        //3g
        //ATT 3G latency: ~400ms
        //Verizon 3G latency: ~150-250ms
        //ATT 3G DL speed: ~60-100kbps
        //Verizon 3G DL speed: ~20-70kbps
        fetchAndCache(false);
    }else{
    //unknown
        fetchAndCache(true);
    }
}

function processOffline() {
    setupApp();
    //disable external links until we come back - setting the bounds of app
    disabledLinks = getUnconvertedLinks(document);
    var i;
    //helper for onlcick below
    var onclickHelper = function(e){
        return function(f) {
            alert('This app is currently offline and cannot access the hotness');return false;
        }
    };
    for (i = 0; i < disabledLinks.length; i += 1) {
        if(disabledLinks[i].onclick == null){
        //alert user we're not online
        disabledLinks[i].onclick = onclickHelper(disabledLinks[i].href);

        }
    }
}

{
  window.addEventListener('load', function(e) {
   //todo - check to see if one already exists for that page
    new Slider("page-container", "sliderFill", "home-page", 100, 0,null);
  }, false);
}

function Slider(track, backfill, page, maxRange, currentPos,callback)
{
    track = document.getElementById(track);
    backfill = document.getElementById(backfill);
    page = document.getElementById(page);
    currentPos = page.style.left;

    var thumbWidth = 20;
    var borderWidth = 10;

    var originalTouch = 0;
    var originalX = 0;

    var slideDirection = null;
    var cancel = false;
    var swipeThreshold = 201;

    var swipeTime;
    var timer;
    var maxPos;

    function pageMove(event) {
        //get position after transform
        var curTransform = new WebKitCSSMatrix(window.getComputedStyle(page).webkitTransform);
        var pagePosition = curTransform.m41;

        //make sure finger is not released
        if(event.type != 'touchend'){
            //holder for current x position
            var currentTouch = event.touches[0].clientX;

            if(event.type == 'touchstart'){
                //reset measurement to 0 each time a new touch begins
                originalTouch = event.touches[0].clientX;
                timer = timerStart();
            }

            //get the difference between where we are now vs. where we started on first touch
            currentPos = currentTouch - originalTouch;

            //figure out if we are cancelling the swipe event
            //simple gauge for finding the highest positive or negative number
            if(pagePosition < 0){
               if(maxPos < pagePosition) {
                    cancel = true;
                }else{
                    maxPos = pagePosition;
                }
            }else{
                if(maxPos > pagePosition) {
                    cancel = true;
                }else {
                    maxPos = pagePosition;
                }
            }

        }else{
            //touch event comes to an end
            swipeTime = timerEnd(timer,'numbers2');
            currentPos = 0;

            //how far do we go before a page flip occurs
            var pageFlipThreshold = 75;

            if(!cancel){
                //find out which direction we're going on x axis
                if(pagePosition > 0){
                //moving current page to the right
                //so means we're flipping backwards
                   if((pagePosition > pageFlipThreshold) || (swipeTime < swipeThreshold)){
                       //user wants to go backward
                       slideDirection = 'right';
                    }else{
                       slideDirection = null;
                    }
                }else{
                //current page is sliding to the left
                    if((swipeTime < swipeThreshold) || (pagePosition < pageFlipThreshold)){
                       //user wants to go forward
                       slideDirection = 'left';
                    }else{
                       slideDirection = null;
                    }

                }
            }
            maxPos = 0;
            cancel = false;
        }

        positionPage();
    }

    function positionPage(end)
    {
        page.style.webkitTransform = 'translate3d('+ currentPos + 'px, 0, 0)';
        if(end){
            page.style.WebkitTransition = 'all .4s ease-out';
            //page.style.WebkitTransition = 'all .4s cubic-bezier(0,.58,.58,1)'
        }else{
            page.style.WebkitTransition = 'all .2s ease-out';
        }
        page.style.WebkitUserSelect = 'none';
    }

    track.ontouchstart = function(event) {
    //alert(event.touches[0].clientX);
        pageMove(event);
    }
    track.ontouchmove = function(event) {
        event.preventDefault();
        pageMove(event);
    }
    track.ontouchend = function(event) {
        pageMove(event);
        if(slideDirection == 'left'){
           slideTo('products-page');
        }else if (slideDirection == 'right'){
            slideTo('home-page');
        }
    }

    positionPage(true);
}


    //    demo3----------------------------checking network type end

</script>

</head>
<body onload="hideURLbar()">
<div id="browser">

      <input type="text" value="" id="numbers3" style="width:300px"/><input type="text" value="" id="numbers" style="width:300px"/><input type="text" value="" id="numbers2" style="width:300px"/> <input type="text" value="" id="decision" style="width:300px"/>
    <nav class="primary">
        <ul>
            <li><a href="#" onclick="slideTo('home-page')">Home</a></li>
            <li><a href="#" onclick="slideTo('products-page')">Products</a></li>
            <li><a href="#" onclick="slideTo('about-page')">About</a></li>
            <li><a href="#" onclick="flip('contact-page')">Contact</a></li>
        </ul>
    </nav>

    <div id="page-container">

        <div id="front" class="normal">
            <div class="sfill" id="sliderFill" style="background-color:red;display:none;">z</div>
            <div id="home-page" class="page">
                <h1>Home Page</h1>
                <a href="demo2/home-detail.html" class="fetch">Find2 out more about the home page!</a>
            </div>

            <div id="products-page" class="page stage-right">
                <h1>Products Page</h1>
                <a href="demo2/product-listing.html" class="fetch">We got some product listings fer ya!</a>
            </div>

            <div id="about-page" class="page stage-left">
                <h1>About Page</h1>
                <a href="demo2/about-cto.html">You know you want to know more about us!</a>
            </div>
        </div>
        <div id="back" class="flipped">

            <div id="contact-page" class="page">
                <h1>Contact Page</h1>
                <a href="demo2/contact-map.html" class="fetch">Check out our map!</a>
            </div>

        </div>

    </div>
</div>

</body>
  <script type="text/javascript">


        </script>
</html>